"""
å·¥ç¨‹ç¿»è­¯å¼•æ“ - Construction Translator

æ ¸å¿ƒåŠŸèƒ½ï¼š
1. å°‡æ¶ˆè²»è€…çš„éœ€æ±‚ç¿»è­¯æˆå·¥ç¨‹é …ç›®
2. è§£é‡‹ç‚ºä»€éº¼éœ€è¦é€™äº›å·¥é …
3. æä¾›ä¸åŒæ–¹æ¡ˆé¸æ“‡
4. ä¼°ç®—å„å·¥é …çš„é ç®—å’Œå·¥æœŸ

ç¯„ä¾‹ï¼š
æ¶ˆè²»è€…èªªã€Œæˆ‘æƒ³æŠŠç£ç£šåœ°æ¿æ”¹æˆæœ¨åœ°æ¿ã€
â†’ Agent è§£é‡‹éœ€è¦ï¼šæ‹†é™¤ â†’ åœ°é¢æ•´å¹³ â†’ é˜²æ½®å±¤ â†’ æœ¨åœ°æ¿æ–½å·¥
â†’ ä¸¦èªªæ˜æ¯å€‹æ­¥é©Ÿçš„åŸå› å’Œæˆæœ¬
"""

from typing import Dict, List, Any, Optional
from dataclasses import dataclass

@dataclass
class ConstructionItem:
    """å·¥ç¨‹é …ç›®"""
    name: str  # å·¥é …åç¨±
    why_needed: str  # ç‚ºä»€éº¼éœ€è¦
    must_do: bool  # æ˜¯å¦å¿…é ˆ
    alternatives: List[str]  # æ›¿ä»£æ–¹æ¡ˆ
    dependencies: List[str]  # å‰ç½®å·¥é …ï¼ˆå¿…é ˆå…ˆåšä»€éº¼ï¼‰
    risks_if_skip: str  # å¦‚æœä¸åšæœƒæœ‰ä»€éº¼é¢¨éšª
    professional_tips: List[str]  # å°ˆæ¥­æé†’ï¼ˆæ¯”è²»ç”¨æ›´æœ‰åƒ¹å€¼çš„å»ºè­°ï¼‰

@dataclass
class ConstructionPlan:
    """å®Œæ•´å·¥ç¨‹è¨ˆç•«"""
    consumer_request: str  # æ¶ˆè²»è€…åŸå§‹éœ€æ±‚
    translated_items: List[ConstructionItem]  # ç¿»è­¯å¾Œçš„å·¥é …
    construction_sequence: List[str]  # æ–½å·¥é †åº
    important_notes: List[str]  # é‡è¦æé†’
    budget_factors: List[str]  # å½±éŸ¿é ç®—çš„é—œéµå› ç´ ï¼ˆä¸å¯«æ­»é‡‘é¡ï¼‰
    timeline_factors: List[str]  # å½±éŸ¿å·¥æœŸçš„é—œéµå› ç´ 

class ConstructionTranslator:
    """
    å·¥ç¨‹ç¿»è­¯å¼•æ“

    æ¶ˆè²»è€…èªªã€Œæˆ‘æƒ³è¦...ã€ â†’ Agent èªªã€Œé‚£æ‚¨éœ€è¦åš...ï¼Œå› ç‚º...ã€
    """

    def __init__(self):
        # é å…ˆå®šç¾©å¸¸è¦‹éœ€æ±‚çš„å·¥ç¨‹å°æ‡‰
        self.translation_rules = self._load_translation_rules()

    def translate(self, consumer_need: str, context: Dict[str, Any] = None) -> ConstructionPlan:
        """
        ç¿»è­¯æ¶ˆè²»è€…éœ€æ±‚ç‚ºå·¥ç¨‹è¨ˆç•«

        :param consumer_need: æ¶ˆè²»è€…çš„éœ€æ±‚æè¿°
        :param context: ä¸Šä¸‹æ–‡è³‡è¨Šï¼ˆç©ºé–“ç‹€æ³ã€é ç®—ç­‰ï¼‰
        :return: å®Œæ•´çš„å·¥ç¨‹è¨ˆç•«
        """
        # é€™è£¡æœƒæœ‰ AI æˆ–è¦å‰‡å¼•æ“ä¾†ç¿»è­¯
        # ç¾åœ¨å…ˆç”¨é å®šç¾©è¦å‰‡ç¤ºç¯„

        if context is None:
            context = {}

        if "ç£ç£š" in consumer_need and "æœ¨åœ°æ¿" in consumer_need:
            return self._translate_tile_to_wood_floor(context)

        elif "å»šæˆ¿" in consumer_need and ("é‡åš" in consumer_need or "æ‰“æ‰" in consumer_need):
            return self._translate_kitchen_renovation(context)

        elif "æµ´å®¤" in consumer_need and ("æ¼æ°´" in consumer_need or "é‡åš" in consumer_need):
            return self._translate_bathroom_renovation(context)

        elif "æ”¶ç´ä¸å¤ " in consumer_need or "è¦åšæ«ƒå­" in consumer_need:
            return self._translate_storage_solution(context)

        elif "é‡æ–°æ²¹æ¼†" in consumer_need:
            return self._translate_painting(context)

        # å…¶ä»–éœ€æ±‚...
        return self._generic_translation(consumer_need, context)

    def _translate_tile_to_wood_floor(self, context: Dict[str, Any] = None) -> ConstructionPlan:
        """
        ç¯„ä¾‹ï¼šç£ç£šæ”¹æœ¨åœ°æ¿

        æ¶ˆè²»è€…èªªï¼šã€Œæˆ‘æƒ³æŠŠå®¢å»³çš„ç£ç£šåœ°æ¿æ”¹æˆæœ¨åœ°æ¿ã€
        Agent è§£é‡‹ï¼šéœ€è¦ä»¥ä¸‹å·¥é …...
        """

        # å–å¾—ä¸Šä¸‹æ–‡è³‡è¨Š
        space_size = context.get("space_size", "ä¸ç¢ºå®š") if context else "ä¸ç¢ºå®š"
        has_moisture_issue = context.get("has_moisture_issue", False) if context else False
        budget_level = context.get("budget_level", "medium") if context else "medium"

        items = []

        # å·¥é … 1: æ‹†é™¤èˆŠç£ç£š
        items.append(ConstructionItem(
            name="æ‹†é™¤èˆŠç£ç£š",
            why_needed="å¿…é ˆå…ˆç§»é™¤èˆŠç£ç£šï¼Œæ‰èƒ½é‹ªè¨­æœ¨åœ°æ¿ã€‚ç£ç£šæ‹†é™¤å¾Œåœ°é¢æœƒä¸å¹³ï¼Œéœ€è¦å¾ŒçºŒè™•ç†ã€‚",
            must_do=True,
            alternatives=[],
            dependencies=[],
            risks_if_skip="ç„¡æ³•æ–½å·¥ï¼Œæœ¨åœ°æ¿ç„¡æ³•ç›´æ¥é‹ªåœ¨ç£ç£šä¸Š",
            professional_tips=[
                "æ‹†é™¤ç£ç£šæœƒç”¢ç”Ÿå¤§é‡ç²‰å¡µå’Œå™ªéŸ³ï¼Œå»ºè­°å…ˆèˆ‡é„°å±…æºé€š",
                "ç¢ºèªæ‹†é™¤è²»ç”¨æ˜¯å¦åŒ…å«ã€Œåƒåœ¾æ¸…é‹ã€ï¼Œé€™å¸¸è¢«éºæ¼",
                "å¦‚æœæ˜¯ä¸€æ¨“æˆ–æœ‰åº—é¢ï¼Œæ³¨æ„ä¸è¦å‚·åˆ°çµæ§‹å±¤"
            ]
        ))

        # å·¥é … 2: åœ°é¢æ•´å¹³
        items.append(ConstructionItem(
            name="åœ°é¢æ•´å¹³ï¼ˆæ³¥ä½œå·¥ç¨‹ï¼‰",
            why_needed="æ‹†é™¤ç£ç£šå¾Œåœ°é¢æœƒæœ‰é«˜ä½å·®å’Œå‘æ´ï¼Œå¿…é ˆæ•´å¹³ã€‚å¦‚æœä¸æ•´å¹³ï¼Œæœ¨åœ°æ¿æœƒä¸å¹³ã€å®¹æ˜“ç™¼å‡ºè²éŸ³ã€ç”šè‡³è®Šå½¢ã€‚",
            must_do=True,
            alternatives=["å¦‚æœåœ°é¢è½å·®ä¸å¤§ï¼ˆ<5mmï¼‰ï¼Œå¯ç”¨è‡ªå¹³æ°´æ³¥"],
            dependencies=["æ‹†é™¤èˆŠç£ç£š"],
            risks_if_skip="æœ¨åœ°æ¿ä¸å¹³ã€å®¹æ˜“è®Šå½¢ã€è¸©è¸æœ‰è²éŸ³ã€é•·æœŸä½¿ç”¨æœƒæå£",
            professional_tips=[
                "æ•´å¹³å¾Œéœ€è¦é¤Šè­·2-3å¤©æ‰èƒ½æ–½ä½œæœ¨åœ°æ¿ï¼Œä¸èƒ½è¶•å·¥",
                "è¦æ±‚å¸«å‚…ç”¨æ°´å¹³å„€ç¢ºèªå¹³æ•´åº¦ï¼Œèª¤å·®æ‡‰<3mm",
                "å¦‚æœåŸåœ°é¢æœ‰è£‚ç¸«ï¼Œè¦å…ˆä¿®è£œæ‰ä¸æœƒå½±éŸ¿æ–°åœ°æ¿"
            ]
        ))

        # å·¥é … 3: é˜²æ½®è™•ç†
        items.append(ConstructionItem(
            name="é˜²æ½®å¸ƒ/é˜²æ½®å¢Šæ–½å·¥",
            why_needed="å°ç£æ°£å€™æ½®æ¿•ï¼Œæœ¨åœ°æ¿ç›´æ¥é‹ªåœ¨æ°´æ³¥ä¸Šå®¹æ˜“å—æ½®è®Šå½¢ã€‚é˜²æ½®å±¤å¯ä»¥éš”çµ•åœ°é¢æ¿•æ°£ï¼Œå»¶é•·æœ¨åœ°æ¿å£½å‘½ã€‚",
            must_do=True if has_moisture_issue else False,
            alternatives=["ä½¿ç”¨æœ‰é˜²æ½®åŠŸèƒ½çš„åº•æ", "é¸æ“‡é˜²æ°´æ€§è¼ƒå¥½çš„SPCåœ°æ¿"],
            dependencies=["åœ°é¢æ•´å¹³"],
            risks_if_skip="æœ¨åœ°æ¿å®¹æ˜“å—æ½®ã€è®Šå½¢ã€ç™¼éœ‰ã€ä½¿ç”¨å£½å‘½ç¸®çŸ­50%ä»¥ä¸Š",
            professional_tips=[
                "ä¸€æ¨“ã€é å±±é‚Šã€æˆ–æ›¾ç¶“æ·¹éæ°´çš„æˆ¿å­ï¼Œé˜²æ½®å±¤ã€Œå¿…åšã€",
                "é˜²æ½®å¸ƒè¦é‡ç–Š10-15cmï¼Œå››é‚Šè¦ä¸Šç‰†10cm",
                "å¦‚æœé ç®—æœ‰é™ï¼Œè‡³å°‘åœ¨å®¹æ˜“æ½®æ¿•çš„å€åŸŸï¼ˆæµ´å®¤å¤–ã€é™½å°æ—ï¼‰åšé˜²æ½®"
            ]
        ))

        # å·¥é … 4: æœ¨åœ°æ¿æ–½å·¥
        wood_floor_options = self._get_wood_floor_options(budget_level)
        items.append(ConstructionItem(
            name=f"æœ¨åœ°æ¿é‹ªè¨­",
            why_needed=f"é€™æ˜¯æ‚¨ä¸»è¦æƒ³è¦çš„é …ç›®ã€‚æœ¨åœ°æ¿ç¨®é¡å¾ˆå¤šï¼ˆè¶…è€ç£¨ã€æµ·å³¶å‹ã€å¯¦æœ¨ã€SPCï¼‰ï¼Œå„æœ‰å„ªç¼ºé»ï¼Œç¾å ´ä¸ˆé‡æ™‚æˆ‘å€‘æœƒè©³ç´°èªªæ˜å¹«æ‚¨é¸æ“‡ã€‚",
            must_do=True,
            alternatives=wood_floor_options['alternatives'],
            dependencies=["åœ°é¢æ•´å¹³", "é˜²æ½®å¸ƒæ–½å·¥"],
            risks_if_skip="é€™æ˜¯ä¸»è¦éœ€æ±‚ï¼Œä¸åšå°±æ²’æ„ç¾©äº†",
            professional_tips=[
                "æœ¨åœ°æ¿è¦é ç•™ã€Œä¼¸ç¸®ç¸«ã€ï¼ˆç‰†é‚Šç•™8-10mmï¼‰ï¼Œå¦å‰‡ç†±è„¹å†·ç¸®æœƒæ‹±èµ·",
                "å»ºè­°é¸æ“‡ã€Œå¡æ‰£å¼ã€æœ¨åœ°æ¿ï¼Œæ—¥å¾Œç¶­ä¿®æ–¹ä¾¿",
                "å¦‚æœæœ‰é¤Šå¯µç‰©ï¼Œå»ºè­°é¸ã€ŒæŠ—åˆ®ä¿‚æ•¸é«˜ã€çš„è¶…è€ç£¨åœ°æ¿",
                "æœ¨åœ°æ¿æ€•æ°´ï¼å»šæˆ¿ã€æµ´å®¤é–€å£å»ºè­°åŠ åšã€Œé˜²æ°´é–€æª»ã€"
            ]
        ))

        # å·¥é … 5: æ”¶é‚Šæ¢èˆ‡è¸¢è…³æ¿
        items.append(ConstructionItem(
            name="æ”¶é‚Šæ¢èˆ‡è¸¢è…³æ¿",
            why_needed="æœ¨åœ°æ¿èˆ‡ç‰†é¢äº¤æ¥è™•éœ€è¦æ”¶é‚Šï¼Œç¾è§€ä¸”ä¿è­·é‚Šç·£ã€‚è¸¢è…³æ¿å¯ä»¥é®è“‹ä¼¸ç¸®ç¸«ï¼Œä¹Ÿèƒ½ä¿è­·ç‰†é¢ä¸è¢«è¸¢é«’ã€‚",
            must_do=False,
            alternatives=["ä¸åšè¸¢è…³æ¿ï¼Œä½†é‚Šç·£æœƒæœ‰ç¸«éš™", "ä½¿ç”¨çŸ½åˆ©åº·å¡«ç¸«ï¼ˆä¸ç¾è§€ä¸”æœƒè®Šé»ƒï¼‰"],
            dependencies=["æœ¨åœ°æ¿é‹ªè¨­"],
            risks_if_skip="ä¸ç¾è§€ã€é‚Šç·£å®¹æ˜“å¡ç°å¡µã€ç‰†é¢å®¹æ˜“è¢«è¸¢é«’æˆ–è¢«æ‹–æŠŠåˆ®å‚·",
            professional_tips=[
                "è¸¢è…³æ¿å»ºè­°é¸æ“‡ã€Œèˆ‡åœ°æ¿åŒè‰²ç³»ã€æˆ–ã€Œèˆ‡é–€æ¡†åŒè‰²ã€æœƒæ¯”è¼ƒå”èª¿",
                "å¦‚æœæœªä¾†æƒ³è£ã€Œæƒåœ°æ©Ÿå™¨äººã€ï¼Œè¸¢è…³æ¿ä¸è¦é¸å¤ªåšçš„",
                "è½‰è§’è™•å»ºè­°ç”¨ã€Œ45åº¦åˆ‡è§’ã€æœƒæ¯”è¼ƒç¾è§€"
            ]
        ))

        # å·¥é … 6: é–€æ¡†èª¿æ•´
        items.append(ConstructionItem(
            name="é–€æ¡†ä¸‹ç·£èª¿æ•´ï¼ˆè¦–ç¾å ´ç‹€æ³ï¼‰",
            why_needed="å¦‚æœæ–°åœ°æ¿æ¯”èˆŠåœ°æ¿åšï¼Œé–€å¯èƒ½æœƒåˆ®åˆ°åœ°æ¿ã€ç„¡æ³•é—œé–‰ã€‚éœ€è¦å°‡é–€ä¸‹ç·£åˆ‡çŸ­æˆ–èª¿æ•´ã€‚",
            must_do=False,  # è¦–ç¾å ´ç‹€æ³
            alternatives=["æ›´æ›æ–°é–€", "æ‹†é™¤é–€æ‰‡é‡æ–°èª¿æ•´é‰¸éˆé«˜åº¦"],
            dependencies=["æœ¨åœ°æ¿é‹ªè¨­"],
            risks_if_skip="é–€ç„¡æ³•æ­£å¸¸é–‹é—œã€æœƒåˆ®å‚·æ–°åœ°æ¿ã€é–€åº•ç¸«éš™å¤ªå°å½±éŸ¿é€šé¢¨",
            professional_tips=[
                "æ–½å·¥å‰è¦å…ˆã€Œè©¦è£ã€ï¼Œç¢ºèªé–€èƒ½ä¸èƒ½æ­£å¸¸é–‹é—œ",
                "é–€åº•èˆ‡åœ°æ¿å»ºè­°ä¿ç•™5-8mmç¸«éš™ï¼ˆé€šé¢¨+ä¸åˆ®åœ°æ¿ï¼‰",
                "å¦‚æœé–€æ˜¯ã€Œç©ºå¿ƒé–€ã€ï¼Œåˆ‡çŸ­å¾Œè¦è¨˜å¾—ã€Œå°åº•ã€ï¼Œå¦å‰‡æœƒé€²èŸ²"
            ]
        ))

        # æ–½å·¥é †åº
        sequence = [
            "1ï¸âƒ£ æ‹†é™¤èˆŠç£ç£š",
            "2ï¸âƒ£ åœ°é¢æ•´å¹³ï¼ˆéœ€é¤Šè­·ç­‰å¾…ï¼‰",
            "3ï¸âƒ£ é‹ªè¨­é˜²æ½®å±¤",
            "4ï¸âƒ£ æœ¨åœ°æ¿æ–½å·¥",
            "5ï¸âƒ£ æ”¶é‚Šèˆ‡è¸¢è…³æ¿",
            "6ï¸âƒ£ é–€æ¡†èª¿æ•´ï¼ˆè¦–ç¾å ´éœ€æ±‚ï¼‰",
            "7ï¸âƒ£ æ¸…æ½”é©—æ”¶"
        ]

        # å½±éŸ¿é ç®—çš„é—œéµå› ç´ 
        budget_factors = [
            "ç©ºé–“åªæ•¸ï¼ˆé€™æ˜¯æœ€ä¸»è¦çš„å› ç´ ï¼‰",
            "æœ¨åœ°æ¿ç¨®é¡ï¼ˆè¶…è€ç£¨ < æµ·å³¶å‹ < å¯¦æœ¨ï¼Œåƒ¹å·®å¯é”2-3å€ï¼‰",
            "åœ°é¢ç‹€æ³ï¼ˆå¦‚æœåŸåœ°é¢å¾ˆä¸å¹³ï¼Œæ•´å¹³è²»ç”¨æœƒå¢åŠ ï¼‰",
            "æ˜¯å¦éœ€è¦æ‹†é™¤èˆŠç£ç£šï¼ˆå¦‚æœæ˜¯èˆŠæœ¨åœ°æ¿æ›æ–°ï¼Œå°±ä¸ç”¨æ‹†ç£ç£šï¼‰",
            "è¸¢è…³æ¿æè³ªï¼ˆæœ¨è³ªã€å¡‘è† ã€é‡‘å±¬åƒ¹æ ¼ä¸åŒï¼‰",
            "é–€çš„æ•¸é‡ï¼ˆæ¯æ‰‡é–€èª¿æ•´éƒ½è¦é¡å¤–è²»ç”¨ï¼‰"
        ]

        # å½±éŸ¿å·¥æœŸçš„é—œéµå› ç´ 
        timeline_factors = [
            "ç©ºé–“åªæ•¸ï¼ˆåªæ•¸è¶Šå¤§ï¼Œå·¥æœŸè¶Šé•·ï¼‰",
            "åœ°é¢æ•´å¹³é¤Šè­·æ™‚é–“ï¼ˆç„¡æ³•çœç•¥ï¼Œéœ€2-3å¤©ï¼‰",
            "æ˜¯å¦è¦ç­‰æœ¨åœ°æ¿è¨‚è²¨ï¼ˆæœ‰äº›ç‰¹æ®Šæ¬¾éœ€è¦ç­‰1-2é€±ï¼‰",
            "æ–½å·¥æ¢ä»¶ï¼ˆå¦‚æœç¹¼çºŒä½åœ¨è£¡é¢ï¼Œå·¥ç­åªèƒ½ç™½å¤©æ–½å·¥ï¼Œæœƒæ‹‰é•·å·¥æœŸï¼‰",
            "ç¤¾å€ç®¡ç†è¦å®šï¼ˆæœ‰äº›ç¤¾å€é™åˆ¶æ–½å·¥æ™‚é–“ï¼Œä¾‹å¦‚åªèƒ½å¹³æ—¥9-5é»ï¼‰"
        ]

        # é‡è¦æé†’
        notes = [
            "âš ï¸ æ–½å·¥æœŸé–“é€™å€‹ç©ºé–“ç„¡æ³•ä½¿ç”¨ï¼Œå»ºè­°äº‹å…ˆè¦åŠƒå®¶å…·æ¬ç§»",
            "âš ï¸ æ‹†é™¤ç£ç£šæœƒæœ‰ã€Œå¤§é‡ç²‰å¡µå’Œå™ªéŸ³ã€ï¼Œå»ºè­°ï¼š",
            "   - å…¶ä»–æˆ¿é–“çš„é–€çª—è²¼ä¸Šå°æ¢æˆ–ç”¨æ¿•æ¯›å·¾å¡é–€ç¸«",
            "   - ä¿è­·å¥½ä¸æ–½å·¥å€åŸŸçš„å®¶å…·ï¼ˆç”¨é˜²å¡µå¸ƒï¼‰",
            "   - äº‹å…ˆèˆ‡é„°å±…æºé€šæ–½å·¥æ™‚é–“",
            "ğŸ’¡ åœ°é¢æ•´å¹³å¾Œçš„ã€Œé¤Šè­·æœŸã€ä¸èƒ½çœç•¥ï¼Œå¦å‰‡æœƒè£‚",
            "ğŸ’¡ æœ¨åœ°æ¿é‹ªå¥½å¾Œå»ºè­°éœç½®24å°æ™‚å†æ”¾é‡ç‰©",
            "ğŸ’¡ é©—æ”¶æ™‚è¦æ³¨æ„ï¼šåœ°æ¿å¹³æ•´åº¦ã€è¸©è¸æœ‰ç„¡ç•°éŸ³ã€æ”¶é‚Šæ˜¯å¦å¯†åˆ"
        ]

        if has_moisture_issue:
            notes.append("ğŸ”´ æ‚¨çš„ç©ºé–“æœ‰æ½®æ¿•ç–‘æ…®ï¼Œã€Œé˜²æ½®å±¤ã€çµ•å°ä¸èƒ½çœï¼é€™æœƒå½±éŸ¿æœ¨åœ°æ¿å£½å‘½")

        return ConstructionPlan(
            consumer_request="æƒ³æŠŠç£ç£šåœ°æ¿æ”¹æˆæœ¨åœ°æ¿",
            translated_items=items,
            construction_sequence=sequence,
            important_notes=notes,
            budget_factors=budget_factors,
            timeline_factors=timeline_factors
        )

    def _translate_bathroom_renovation(self, context: Dict[str, Any] = None) -> ConstructionPlan:
        """ç¯„ä¾‹ï¼šæµ´å®¤æ•´ä¿®"""

        has_leak = context.get("has_leak", True) if context else True
        items = []

        if has_leak:
            items.extend([
                ConstructionItem(
                    name="æ‹†é™¤èˆŠç£ç£šèˆ‡è¡›æµ´è¨­å‚™",
                    why_needed="å¿…é ˆæ‹†åˆ°è¦‹åº•ï¼ˆç´…ç£šæˆ–æ°´æ³¥ï¼‰ï¼Œæ‰èƒ½é‡åšé˜²æ°´ã€‚å¦‚æœåªæ‹†è¡¨é¢ï¼Œæ¼æ°´å•é¡Œç„¡æ³•æ ¹æ²»ã€‚",
                    must_do=True,
                    alternatives=[],
                    estimated_cost_range="3-5è¬ï¼ˆè¦–æµ´å®¤å¤§å°ï¼‰",
                    estimated_duration="1-2å¤©",
                    dependencies=[],
                    risks_if_skip="æ¼æ°´å•é¡Œç„¡æ³•è§£æ±º"
                ),
                ConstructionItem(
                    name="é˜²æ°´å·¥ç¨‹ï¼ˆé‡é»ï¼ï¼‰",
                    why_needed="æµ´å®¤æ¼æ°´çš„æ ¹æœ¬åŸå› æ˜¯é˜²æ°´å±¤å¤±æ•ˆã€‚å¿…é ˆé‡åšé˜²æ°´å±¤ï¼ˆè‡³å°‘åˆ·å…©å±¤ï¼‰ï¼Œä¸¦åšã€Œ48å°æ™‚è©¦æ°´æ¸¬è©¦ã€ç¢ºä¿ä¸æ¼ã€‚é€™æ˜¯æœ€é‡è¦çš„å·¥é …ï¼",
                    must_do=True,
                    alternatives=["å±€éƒ¨ä¿®è£œï¼ˆä½†æ²»æ¨™ä¸æ²»æœ¬ï¼Œä¸å»ºè­°ï¼‰"],
                    estimated_cost_range="1.5-3è¬ï¼ˆå«è©¦æ°´ï¼‰",
                    estimated_duration="3-5å¤©ï¼ˆå«è©¦æ°´å’Œé¤Šè­·ï¼‰",
                    dependencies=["æ‹†é™¤"],
                    risks_if_skip="ç¹¼çºŒæ¼æ°´ï¼Œå¯èƒ½å½±éŸ¿æ¨“ä¸‹é„°å±…ï¼Œå¾ŒçºŒç³¾ç´›æ›´éº»ç…©"
                ),
                ConstructionItem(
                    name="æ³¥ä½œæ‰“åº•èˆ‡è²¼ç£ç£š",
                    why_needed="é˜²æ°´å±¤åšå¥½å¾Œï¼Œéœ€è¦æ‰“åº•æ•´å¹³ï¼Œç„¶å¾Œè²¼ä¸Šæ–°ç£ç£šã€‚ç£ç£šé¸æ“‡æœƒå½±éŸ¿åƒ¹æ ¼ï¼ˆå¾æ¯åª3åƒåˆ°ä¸Šè¬éƒ½æœ‰ï¼‰ã€‚",
                    must_do=True,
                    alternatives=["å¯é¸æ“‡ä¸åŒç­‰ç´šçš„ç£ç£š"],
                    estimated_cost_range="3-6è¬ï¼ˆå«å·¥å¸¶æ–™ï¼‰",
                    estimated_duration="3-5å¤©",
                    dependencies=["é˜²æ°´å·¥ç¨‹"],
                    risks_if_skip="ç„¡æ³•å®Œæˆæµ´å®¤æ•´ä¿®"
                ),
                ConstructionItem(
                    name="æ°´é›»ç®¡ç·šæ›´æ–°",
                    why_needed="æ—¢ç„¶éƒ½æ‹†äº†ï¼Œå»ºè­°é †ä¾¿æª¢æŸ¥æ°´é›»ç®¡ç·šã€‚å¦‚æœæˆ¿é½¡è¶…é10å¹´ï¼Œå¼·çƒˆå»ºè­°æ›´æ–°ï¼Œé¿å…æ—¥å¾Œåˆè¦æ‰“ç‰†ã€‚",
                    must_do=False,
                    alternatives=["åªæ›è€èˆŠéƒ¨åˆ†", "ç¶­æŒåŸç‹€ï¼ˆæœ‰é¢¨éšªï¼‰"],
                    estimated_cost_range="1.5-3è¬",
                    estimated_duration="1-2å¤©",
                    dependencies=["æ‹†é™¤"],
                    risks_if_skip="æ—¥å¾Œç®¡ç·šè€åŒ–ï¼Œåˆè¦é‡æ–°æ‰“ç‰†"
                ),
                ConstructionItem(
                    name="è¡›æµ´è¨­å‚™å®‰è£",
                    why_needed="åŒ…æ‹¬é¦¬æ¡¶ã€æ´—æ‰‹å°ã€æ·‹æµ´è¨­å‚™ã€æ°´é¾é ­ç­‰ã€‚å¯ä»¥é¸æ“‡ä¸åŒç­‰ç´šçš„è¨­å‚™ã€‚",
                    must_do=True,
                    alternatives=["ä¿ç•™éƒ¨åˆ†èˆŠè¨­å‚™ï¼ˆä¸å»ºè­°ï¼‰"],
                    estimated_cost_range="2-8è¬ï¼ˆè¦–è¨­å‚™ç­‰ç´šï¼‰",
                    estimated_duration="1-2å¤©",
                    dependencies=["æ³¥ä½œè²¼ç£ç£š", "æ°´é›»ç®¡ç·š"],
                    risks_if_skip="ç„¡æ³•ä½¿ç”¨æµ´å®¤"
                )
            ])

        return ConstructionPlan(
            consumer_request="æµ´å®¤æ¼æ°´æƒ³é‡åš",
            translated_items=items,
            total_estimated_cost="12-25è¬ï¼ˆè¦–æµ´å®¤å¤§å°å’Œè¨­å‚™ç­‰ç´šï¼‰",
            total_duration="ç´„ 10-14 å€‹å·¥ä½œå¤©",
            construction_sequence=[
                "1ï¸âƒ£ æ‹†é™¤ï¼ˆ1-2å¤©ï¼‰",
                "2ï¸âƒ£ æ°´é›»ç®¡ç·šæ›´æ–°ï¼ˆ1-2å¤©ï¼‰",
                "3ï¸âƒ£ é˜²æ°´å±¤æ–½å·¥ï¼ˆ2å¤©ï¼‰",
                "4ï¸âƒ£ 48å°æ™‚è©¦æ°´æ¸¬è©¦",
                "5ï¸âƒ£ æ³¥ä½œæ‰“åº•èˆ‡è²¼ç£ç£šï¼ˆ3-5å¤©ï¼‰",
                "6ï¸âƒ£ è¡›æµ´è¨­å‚™å®‰è£ï¼ˆ1-2å¤©ï¼‰",
                "7ï¸âƒ£ é©—æ”¶èˆ‡æ¸…æ½”"
            ],
            important_notes=[
                "ğŸš¨ æµ´å®¤æ•´ä¿®æœŸé–“ç„¡æ³•ä½¿ç”¨ï¼Œè«‹å®‰æ’å…¶ä»–ç›¥æ´—åœ°é»",
                "âš ï¸ é˜²æ°´å±¤çš„ã€Œ48å°æ™‚è©¦æ°´æ¸¬è©¦ã€çµ•å°ä¸èƒ½çœç•¥ï¼é€™æ˜¯ç¢ºä¿ä¸æ¼æ°´çš„å”¯ä¸€æ–¹æ³•",
                "ğŸ’¡ å»ºè­°åŒæ™‚æ›´æ–°æ°´é›»ç®¡ç·šï¼Œé¿å…æ—¥å¾Œåˆè¦æ‰“ç‰†",
                "ğŸ’¡ ç£ç£šå»ºè­°é¸æ“‡é˜²æ»‘ä¿‚æ•¸é«˜çš„ï¼ˆç‰¹åˆ¥æ˜¯æ·‹æµ´å€ï¼‰",
                "ğŸ’¡ å¦‚æœé ç®—å…è¨±ï¼Œå¯ä»¥è€ƒæ…®ã€Œä¹¾æ¿•åˆ†é›¢ã€è¨­è¨ˆ"
            ]
        )

    def _translate_kitchen_renovation(self, context: Dict[str, Any] = None) -> ConstructionPlan:
        """ç¯„ä¾‹ï¼šå»šæˆ¿æ•´ä¿®"""
        items = [
            ConstructionItem(
                name="æ‹†é™¤èˆŠå»šå…·èˆ‡æª¯é¢",
                why_needed="èˆŠå»šå…·ã€æª¯é¢ã€å£ç£šéœ€è¦æ‹†é™¤ï¼Œæ‰èƒ½å®‰è£æ–°çš„ã€‚æ‹†é™¤æ™‚è¦æ³¨æ„ä¿è­·ç“¦æ–¯ç®¡ç·šå’Œæ°´ç®¡ã€‚",
                must_do=True,
                alternatives=[],
                estimated_cost_range="1-2è¬",
                estimated_duration="1å¤©",
                dependencies=[],
                risks_if_skip="ç„¡æ³•æ–½å·¥"
            ),
            ConstructionItem(
                name="æ°´é›»ç®¡ç·šèª¿æ•´",
                why_needed="æ–°å»šå…·çš„é…ç½®å¯èƒ½å’ŒèˆŠçš„ä¸åŒï¼ˆæ’åº§ä½ç½®ã€çµ¦æ’æ°´ä½ç½®ã€ç“¦æ–¯ç®¡ç·šï¼‰ã€‚éœ€è¦é‡æ–°é…ç½®æ°´é›»ã€‚",
                must_do=True,
                alternatives=["é·å°±èˆŠç®¡ç·šä½ç½®ï¼ˆæœƒé™åˆ¶è¨­è¨ˆï¼‰"],
                estimated_cost_range="1.5-3è¬",
                estimated_duration="1-2å¤©",
                dependencies=["æ‹†é™¤"],
                risks_if_skip="æ–°å»šå…·ç„¡æ³•æ­£å¸¸ä½¿ç”¨"
            ),
            ConstructionItem(
                name="å£ç£šæˆ–å£æ¿æ–½å·¥",
                why_needed="å»šæˆ¿ç‰†é¢éœ€è¦é˜²æ²¹ã€é˜²æ°´ã€å¥½æ¸…æ½”ã€‚å¯ä»¥é¸æ“‡è²¼ç£ç£šï¼ˆå‚³çµ±ï¼‰æˆ–å®‰è£ç¾è€æ¿/çƒ¤æ¼†ç»ç’ƒï¼ˆç¾ä»£ï¼‰ã€‚",
                must_do=False,
                alternatives=["ä½¿ç”¨é˜²æ²¹æ¼†ï¼ˆè¼ƒä¸è€ç”¨ï¼‰", "ä¸åšï¼ˆæœƒå¾ˆé›£æ¸…æ½”ï¼‰"],
                estimated_cost_range="2-4è¬ï¼ˆè¦–æè³ªï¼‰",
                estimated_duration="2-3å¤©",
                dependencies=["æ°´é›»èª¿æ•´"],
                risks_if_skip="ç‰†é¢å®¹æ˜“æ²¹è†©ã€é›£æ¸…æ½”"
            ),
            ConstructionItem(
                name="è¨‚è£½å»šå…·æ«ƒé«”èˆ‡æª¯é¢",
                why_needed="é€™æ˜¯å»šæˆ¿çš„ä¸»é«”ã€‚åŒ…æ‹¬ä¸‹æ«ƒã€ä¸Šæ«ƒã€æª¯é¢ã€‚æè³ªé¸æ“‡å¾ˆå¤šï¼ˆç³»çµ±æ«ƒã€æœ¨ä½œã€ä¸é½é‹¼ç­‰ï¼‰ï¼Œåƒ¹å·®å¾ˆå¤§ã€‚",
                must_do=True,
                alternatives=["ä¸åŒæè³ªé¸æ“‡ï¼šç³»çµ±æ«ƒ < æœ¨ä½œ < ä¸é½é‹¼"],
                estimated_cost_range="8-20è¬ï¼ˆè¦–å°ºå¯¸å’Œæè³ªï¼‰",
                estimated_duration="1-2å¤©å®‰è£ï¼ˆéœ€æå‰è¨‚è£½2-4é€±ï¼‰",
                dependencies=["å£ç£š"],
                risks_if_skip="ç„¡æ³•ä½¿ç”¨å»šæˆ¿"
            ),
            ConstructionItem(
                name="å»šæˆ¿è¨­å‚™å®‰è£",
                why_needed="åŒ…æ‹¬çˆå…·ã€æŠ½æ²¹ç…™æ©Ÿã€æ°´æ§½ã€æ°´é¾é ­ç­‰ã€‚é€™äº›è¨­å‚™å¯ä»¥è‡ªå·±è²·æˆ–è«‹å» å•†é…ã€‚",
                must_do=True,
                alternatives=["ä¿ç•™èˆŠè¨­å‚™ï¼ˆå¦‚æœé‚„èƒ½ç”¨ï¼‰"],
                estimated_cost_range="2-6è¬ï¼ˆè¦–è¨­å‚™ç­‰ç´šï¼‰",
                estimated_duration="1å¤©",
                dependencies=["å»šå…·æ«ƒé«”"],
                risks_if_skip="å»šæˆ¿ç„¡æ³•é‹ä½œ"
            )
        ]

        return ConstructionPlan(
            consumer_request="å»šæˆ¿æƒ³è¦æ‰“æ‰é‡åš",
            translated_items=items,
            total_estimated_cost="15-35è¬ï¼ˆè¦–å°ºå¯¸å’Œè¨­å‚™ç­‰ç´šï¼‰",
            total_duration="ç´„ 7-10 å€‹å·¥ä½œå¤©ï¼ˆä¸å«è¨‚è£½ç­‰å¾…æœŸï¼‰",
            construction_sequence=[
                "1ï¸âƒ£ æ‹†é™¤èˆŠå»šå…·ï¼ˆ1å¤©ï¼‰",
                "2ï¸âƒ£ æ°´é›»ç®¡ç·šèª¿æ•´ï¼ˆ1-2å¤©ï¼‰",
                "3ï¸âƒ£ å£ç£šæˆ–å£æ¿æ–½å·¥ï¼ˆ2-3å¤©ï¼‰",
                "â¸ï¸  ç­‰å¾…å»šå…·è¨‚è£½ï¼ˆ2-4é€±ï¼Œå¯èˆ‡å‰é¢å·¥ç¨‹ä¸¦è¡Œï¼‰",
                "4ï¸âƒ£ å»šå…·æ«ƒé«”å®‰è£ï¼ˆ1-2å¤©ï¼‰",
                "5ï¸âƒ£ å»šæˆ¿è¨­å‚™å®‰è£ï¼ˆ1å¤©ï¼‰",
                "6ï¸âƒ£ é©—æ”¶èˆ‡æ¸…æ½”"
            ],
            important_notes=[
                "âš ï¸ å»šæˆ¿æ–½å·¥æœŸé–“ç„¡æ³•ç…®é£¯ï¼Œè«‹å®‰æ’å¤–é£Ÿæˆ–ç°¡æ˜“çƒ¹èª¿",
                "ğŸ’¡ å»šå…·éœ€è¦æå‰è¨‚è£½ï¼ˆ2-4é€±ï¼‰ï¼Œå»ºè­°å…ˆç¢ºèªè¨­è¨ˆå’Œå°ºå¯¸",
                "ğŸ’¡ æŠ½æ²¹ç…™æ©Ÿè¦é¸å°ï¼ˆæ’é¢¨é‡è¦å¤ ã€å™ªéŸ³è¦ä½ï¼‰",
                "ğŸ’¡ æ’åº§æ•¸é‡è¦å¤ ï¼ˆçƒ¤ç®±ã€å¾®æ³¢çˆã€é›»é‹ã€ç†±æ°´ç“¶...ï¼‰ï¼Œå»ºè­°è‡³å°‘6å€‹",
                "ğŸ’¡ æª¯é¢å»ºè­°é¸æ“‡çŸ³è‹±çŸ³æˆ–äººé€ çŸ³ï¼ˆæ¯”å¤©ç„¶å¤§ç†çŸ³å¥½ä¿é¤Šï¼‰"
            ]
        )

    def _get_wood_floor_options(self, budget_level: str) -> Dict[str, Any]:
        """æ ¹æ“šé ç®—æ¨è–¦æœ¨åœ°æ¿é¸é …"""
        options = {
            "low": {
                "recommended": "è¶…è€ç£¨æœ¨åœ°æ¿",
                "alternatives": ["SPCçŸ³å¡‘åœ°æ¿ï¼ˆæ›´é˜²æ°´ï¼‰", "æµ·å³¶å‹æœ¨åœ°æ¿ï¼ˆåŸºç¤æ¬¾ï¼‰"],
                "cost_range": "æ¯åª 3,500-5,000 å…ƒï¼ˆå«å·¥å¸¶æ–™ï¼‰"
            },
            "medium": {
                "recommended": "æµ·å³¶å‹æœ¨åœ°æ¿",
                "alternatives": ["é«˜éšè¶…è€ç£¨æœ¨åœ°æ¿", "SPCçŸ³å¡‘åœ°æ¿"],
                "cost_range": "æ¯åª 5,000-8,000 å…ƒï¼ˆå«å·¥å¸¶æ–™ï¼‰"
            },
            "high": {
                "recommended": "å¯¦æœ¨åœ°æ¿æˆ–é«˜éšæµ·å³¶å‹",
                "alternatives": ["é ‚ç´šè¶…è€ç£¨æœ¨åœ°æ¿", "é€²å£æµ·å³¶å‹æœ¨åœ°æ¿"],
                "cost_range": "æ¯åª 8,000-15,000 å…ƒï¼ˆå«å·¥å¸¶æ–™ï¼‰"
            }
        }
        return options.get(budget_level, options["medium"])

    def _calculate_total_cost(self, items: List[ConstructionItem], space_size: str) -> str:
        """è¨ˆç®—ç¸½é ç®—ï¼ˆç°¡åŒ–ç‰ˆï¼‰"""
        # å¯¦éš›æœƒæ ¹æ“šåªæ•¸å’Œæ¯å€‹å·¥é …çš„å–®åƒ¹è¨ˆç®—
        # é€™è£¡å…ˆç”¨é è¨­ç¯„åœ
        return "ä¾æ‚¨çš„ç©ºé–“å¤§å°ï¼Œé ä¼°ç¸½è²»ç”¨ç´„ X-Y è¬å…ƒ"

    def _load_translation_rules(self) -> Dict:
        """è¼‰å…¥ç¿»è­¯è¦å‰‡åº«ï¼ˆæœªä¾†å¯ä»¥å¾è³‡æ–™åº«æˆ–AIæ¨¡å‹ï¼‰"""
        return {}

    def _generic_translation(self, need: str, context: Dict) -> ConstructionPlan:
        """é€šç”¨ç¿»è­¯ï¼ˆå¦‚æœæ²’æœ‰é å®šç¾©è¦å‰‡ï¼‰"""
        return ConstructionPlan(
            consumer_request=need,
            translated_items=[],
            total_estimated_cost="å¾…è©•ä¼°",
            total_duration="å¾…è©•ä¼°",
            construction_sequence=[],
            important_notes=["éœ€è¦æ›´å¤šè³‡è¨Šæ‰èƒ½æä¾›è©³ç´°å»ºè­°"]
        )

# ===== ä½¿ç”¨ç¯„ä¾‹ =====
if __name__ == "__main__":
    translator = ConstructionTranslator()

    # ç¯„ä¾‹ 1: ç£ç£šæ”¹æœ¨åœ°æ¿
    plan = translator.translate(
        consumer_need="æˆ‘æƒ³æŠŠå®¢å»³çš„ç£ç£šæ”¹æˆæœ¨åœ°æ¿",
        context={
            "space_size": "8åª",
            "has_moisture_issue": False,
            "budget_level": "medium"
        }
    )

    print("=" * 60)
    print(f"æ¶ˆè²»è€…éœ€æ±‚ï¼š{plan.consumer_request}")
    print("=" * 60)
    print("\néœ€è¦é€²è¡Œçš„å·¥ç¨‹é …ç›®ï¼š\n")

    for i, item in enumerate(plan.translated_items, 1):
        must_tag = "ã€å¿…é ˆã€‘" if item.must_do else "ã€å»ºè­°ã€‘"
        print(f"{i}. {must_tag} {item.name}")
        print(f"   ğŸ’¬ ç‚ºä»€éº¼éœ€è¦ï¼š")
        print(f"      {item.why_needed}")

        if item.alternatives:
            print(f"   ğŸ”„ æ›¿ä»£æ–¹æ¡ˆï¼š")
            for alt in item.alternatives:
                print(f"      â€¢ {alt}")

        print(f"   âš ï¸  ä¸åšçš„é¢¨éšªï¼š")
        print(f"      {item.risks_if_skip}")

        if item.professional_tips:
            print(f"   ğŸ’¡ å°ˆæ¥­æé†’ï¼š")
            for tip in item.professional_tips:
                print(f"      â€¢ {tip}")
        print()

    print("=" * 60)
    print("ğŸ“‹ æ–½å·¥é †åºï¼š")
    print("=" * 60)
    for step in plan.construction_sequence:
        print(f"  {step}")

    print("\n" + "=" * 60)
    print("ğŸ’° å½±éŸ¿é ç®—çš„é—œéµå› ç´ ï¼š")
    print("=" * 60)
    for factor in plan.budget_factors:
        print(f"  â€¢ {factor}")

    print("\n" + "=" * 60)
    print("â±ï¸  å½±éŸ¿å·¥æœŸçš„é—œéµå› ç´ ï¼š")
    print("=" * 60)
    for factor in plan.timeline_factors:
        print(f"  â€¢ {factor}")

    print("\n" + "=" * 60)
    print("ğŸ“Œ é‡è¦æé†’ï¼š")
    print("=" * 60)
    for note in plan.important_notes:
        print(f"  {note}")
