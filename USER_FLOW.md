# Nooko 裝潢 AI 夥伴 - 使用者流程圖

## 完整流程概覽

```
┌─────────────────────────────────────────────────────────────────┐
│                         歡迎頁面                                  │
│  • 系統自動建立專案 ID                                             │
│  • 顯示服務特色介紹                                                │
│  • 開始使用按鈕                                                    │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                   步驟 1/3: 上傳報價單                            │
│  • 選擇檔案（PDF / Excel / 圖片）                                 │
│  • 上傳至後端儲存                                                  │
│  • 或選擇「跳過」直接進入訪談                                      │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                  步驟 2/3: 互動式需求訪談                         │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 進度條: ████████░░░░░░░░░░░░ 30% 完成                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 類別標籤: [空間現況與使用目的]                             │   │
│  │                                                           │   │
│  │ 問題: 請問這個空間目前的使用情況是什麼？                   │   │
│  │                                                           │   │
│  │ ℹ️ 目的: 決定工程預算取向（自住重品質，出租重耐用性）      │   │
│  │                                                           │   │
│  │ 選項:                                                      │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐                 │   │
│  │  │  自住    │ │  出租    │ │  短租    │                 │   │
│  │  └──────────┘ └──────────┘ └──────────┘                 │   │
│  │  ┌──────────┐ ┌──────────┐                              │   │
│  │  │ 家人使用  │ │  其他    │                              │   │
│  │  └──────────┘ └──────────┘                              │   │
│  │                                                           │   │
│  │ 補充說明: ________________________________                │   │
│  │                                                           │   │
│  │                          [下一步 →]                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                   │
│  訪談涵蓋 27 個問題，分為以下類別：                                │
│  ✓ 基本資訊（客戶稱呼）                                           │
│  ✓ 空間現況與使用目的（4題）                                      │
│  ✓ 預算與期望（3題）                                              │
│  ✓ 設計與風格偏好（3題）                                          │
│  ✓ 拆除與保護工程（1題）                                          │
│  ✓ 防水工程（1題）                                                │
│  ✓ 水電工程（2題）                                                │
│  ✓ 機電整合（1題）                                                │
│  ✓ 泥作工程（1題）                                                │
│  ✓ 磁磚石材工程（1題）                                            │
│  ✓ 木作工程（1題）                                                │
│  ✓ 系統櫃與廚具（1題）                                            │
│  ✓ 油漆工程（1題）                                                │
│  ✓ 地板工程（1題）                                                │
│  ✓ 施工條件（2題）                                                │
│  ✓ 驗收與保固（3題）                                              │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                     訪談完成確認                                  │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              ✓ 需求訪談完成！                             │   │
│  │                                                           │   │
│  │  王先生，感謝您提供這麼詳細的資訊！                        │   │
│  │                                                           │   │
│  │  根據您的需求，我已經為您整理出完整的專案簡報：           │   │
│  │  • 裝修風格：北歐風（簡約、明亮、木質感）                 │   │
│  │  • 預算範圍：100-200萬                                    │   │
│  │  • 工程範圍：全室裝修（包含水電、衛浴）                   │   │
│  │                                                           │   │
│  │  現在我會將這份資料交給我們的專業統包商和設計師團隊：     │   │
│  │  1. 產出詳細的規格報價單（包含可能遺漏的項目）            │   │
│  │  2. 設計符合您風格的概念渲染圖                            │   │
│  │                                                           │   │
│  │  進度: ████████████████████ 100% 完成                     │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                 專業團隊分析處理中...                              │
│  （系統後台觸發 Contractor Agent 與 Designer Agent）              │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                 步驟 3/3: 專業分析結果                             │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │           詳細規格報價單                                   │   │
│  │  ┌───────────────────────────────────────────────┐      │   │
│  │  │ 工程項目          規格          單價    總價    │      │   │
│  │  │────────────────────────────────────────────│      │   │
│  │  │ 拆除工程                                        │      │   │
│  │  │  - 舊地磚拆除      全室 30坪   $500   $15,000  │      │   │
│  │  │  - 保護工程        式          $3,000  $3,000  │      │   │
│  │  │                                                 │      │   │
│  │  │ 水電工程                                        │      │   │
│  │  │  - 全室配線更新    式         $80,000 $80,000  │      │   │
│  │  │  - 插座增設        10個        $800    $8,000  │      │   │
│  │  │  ⚠️ 建議項目：漏電斷路器更新（原報價未含）    │      │   │
│  │  │    預估: $5,000                                 │      │   │
│  │  │                                                 │      │   │
│  │  │ ... （其他工程項目）                            │      │   │
│  │  │────────────────────────────────────────────│      │   │
│  │  │ 總計: $1,250,000                               │      │   │
│  │  └───────────────────────────────────────────────┘      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │           設計概念渲染圖                                   │   │
│  │  ┌───────────────┐  ┌───────────────┐                   │   │
│  │  │               │  │               │                   │   │
│  │  │  客廳北歐風    │  │  臥室設計圖    │                   │   │
│  │  │  概念圖        │  │               │                   │   │
│  │  │               │  │               │                   │   │
│  │  └───────────────┘  └───────────────┘                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                   │
│                    [預約免費丈量]                                  │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                      預約表單                                     │
│  • 姓名                                                           │
│  • 聯絡電話                                                       │
│  • Email                                                          │
│  • 希望聯繫時間                                                   │
│  • 備註                                                           │
│                                                                   │
│                    [確認預約]                                     │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    預約成功確認                                   │
│  感謝您的預約！我們會盡快與您聯繫安排免費丈量時間。                │
└─────────────────────────────────────────────────────────────────┘
```

## 技術流程圖

```
前端 (React)                          後端 (FastAPI)                     資料庫
────────────                          ──────────────                     ──────

[載入應用]
    │
    ├──► POST /api/projects ────────────► 建立專案 ID
    │                                     初始化 ClientManagerAgent
    │                                     建立 session
    │                         ◄─────────  返回 project_id
    │
[歡迎頁]
    │
    ├──► [開始使用]
    │
[上傳頁]
    │
    ├──► POST /api/projects/{id}/upload ──► 儲存檔案資訊 ────► 更新專案
    │                         ◄─────────  返回成功訊息
    │
[訪談頁]
    │
    ├──► POST /api/projects/{id}/         取得第一題
    │         conversation/start    ──────► from ClientManagerAgent
    │                         ◄─────────  返回問題 JSON
    │
    ├──► [用戶回答問題]
    │
    ├──► POST /api/projects/{id}/         處理答案
    │         conversation/answer   ──────► 更新 context ────────► 儲存答案
    │                                     取得下一題
    │                         ◄─────────  返回下一題 JSON
    │
    ├──► [重複直到所有問題完成]
    │
    ├──► [最後一題提交]
    │
    ├──► POST /api/projects/{id}/         編譯專案簡報
    │         conversation/answer   ──────► compile_project_brief() ► 儲存簡報
    │                                     生成總結訊息
    │                         ◄─────────  返回 completed=true
    │                                           + project_brief
    │
[結果頁]
    │
    ├──► [顯示報價單與渲染圖]
    │    （未來整合 Contractor & Designer Agents）
    │
    ├──► [預約免費丈量]
    │
[預約頁]
    │
    └──► POST /api/projects/book ──────► 儲存預約資訊 ────► 寫入 Firestore
                              ◄─────────  返回確認訊息
```

## 資料結構

### 1. 專案初始化
```json
{
  "project_id": "uuid-xxxx-xxxx",
  "user_id": "anonymous",
  "status": "created",
  "created_at": "2024-11-16T10:00:00",
  "welcome_message": "歡迎來到 Nooko..."
}
```

### 2. 問題格式
```json
{
  "id": "space_001",
  "category": "空間現況與使用目的",
  "text": "請問這個空間目前的使用情況是什麼？",
  "options": ["自住", "出租", "短租", "家人使用", "其他"],
  "info_purpose": "決定工程預算取向（自住重品質，出租重耐用性）"
}
```

### 3. 答案提交
```json
{
  "question_id": "space_001",
  "answer": "自住"
}
```

### 4. 下一題回應
```json
{
  "project_id": "uuid-xxxx",
  "completed": false,
  "question": {
    "id": "space_002",
    "category": "空間現況與使用目的",
    "text": "原先的裝潢做了多久？...",
    "options": [...],
    "info_purpose": "評估是否需額外修繕工程"
  },
  "progress": 15
}
```

### 5. 完成回應
```json
{
  "project_id": "uuid-xxxx",
  "completed": true,
  "summary": "王先生，感謝您提供...",
  "project_brief": {
    "project_id": "uuid-xxxx",
    "user_profile": {...},
    "budget_info": {...},
    "style_preferences": {...},
    "construction_requirements": {...}
  },
  "progress": 100
}
```

## API 端點總覽

| 方法   | 端點                                      | 說明                   |
|--------|------------------------------------------|------------------------|
| POST   | `/api/projects`                          | 建立新專案              |
| GET    | `/api/projects/{id}`                     | 取得專案資訊            |
| POST   | `/api/projects/{id}/upload`              | 上傳報價單              |
| POST   | `/api/projects/{id}/conversation/start`  | 開始訪談流程            |
| POST   | `/api/projects/{id}/conversation/answer` | 提交答案並取得下一題    |
| GET    | `/api/projects/{id}/conversation/status` | 查詢訪談進度            |
| POST   | `/api/projects/book`                     | 提交預約資訊            |

---

這個流程設計確保了：
✅ **使用者友善**：清晰的進度指示和即時反饋
✅ **專業完整**：涵蓋所有關鍵裝修項目
✅ **資訊透明**：每個問題都說明收集目的
✅ **彈性輸入**：支援選項和自由文字
✅ **狀態管理**：完整的會話追蹤與持久化
