# HouseIQ 本地測試指南

## 📋 前置準備

### 系統需求
- **Python**: 3.9+ (建議 3.11)
- **Node.js**: 18+ (建議 20+)
- **npm**: 9+
- **終端機**: 需要兩個終端機視窗（一個給後端，一個給前端）

### 檢查版本
```bash
python3 --version  # 應顯示 Python 3.9 或更高
node --version     # 應顯示 v18.0.0 或更高
npm --version      # 應顯示 9.0.0 或更高
```

---

## 🚀 快速啟動（5分鐘）

### 步驟 1: 啟動後端服務

打開**第一個終端機視窗**，執行：

```bash
# 1. 進入後端目錄
cd /Users/stephen/Desktop/Nooko_Your_InteriorDeco_Ai/analysis-service

# 2. 安裝 Python 依賴（首次執行需要）
pip3 install -r requirements.txt

# 3. 啟動 FastAPI 服務
uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

**預期輸出**：
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxxx] using WatchFiles
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

✅ **驗證後端啟動成功**：
在瀏覽器開啟 http://localhost:8000
應該看到：
```json
{"message": "Analysis Service is running!"}
```

---

### 步驟 2: 啟動前端服務

打開**第二個終端機視窗**，執行：

```bash
# 1. 進入前端目錄
cd /Users/stephen/Desktop/Nooko_Your_InteriorDeco_Ai/web-service

# 2. 安裝 Node.js 依賴（首次執行需要，可能需要 3-5 分鐘）
npm install

# 3. 啟動 Vite 開發伺服器
npm run dev
```

**預期輸出**：
```
  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
  ➜  press h + enter to show help
```

✅ **驗證前端啟動成功**：
在瀏覽器開啟 http://localhost:5173
應該看到 HouseIQ 的歡迎頁面

---

## 🧪 完整測試流程

### 測試 1: 歡迎頁面

1. 開啟 http://localhost:5173
2. 確認看到：
   - 標題：「🏠 HouseIQ 裝潢 AI 夥伴」
   - 副標題：「透明報價 • 專業建議 • 讓裝潢不再是資訊不對稱的遊戲」
   - 歡迎訊息
   - 功能特色列表
   - 「開始使用」按鈕
   - 頁面底部顯示「專案 ID: xxx-xxx-xxx」

3. **開發者工具檢查**（按 F12）：
   - 在 Console 分頁，應該看到成功建立專案的訊息
   - 在 Network 分頁，確認有對 `http://localhost:8000/api/projects` 的 POST 請求，且回應 200

---

### 測試 2: 報價單上傳

1. 點擊「開始使用」按鈕
2. 進入「步驟 1/3: 上傳報價單」頁面
3. **測試檔案上傳**：
   - 點擊「選擇檔案」
   - 選擇任意 PDF 或 Excel 檔案（可以是空檔案）
   - 點擊「上傳報價單」
   - 應該看到「✓ 報價單已成功上傳！我會先分析您的報價單...」
   - 1.5秒後自動跳轉到訪談頁面

4. **測試跳過上傳**：
   - 或者直接點擊「跳過上傳，直接進入需求訪談」
   - 應該立即進入訪談頁面

---

### 測試 3: 互動式需求訪談（重點！）

進入訪談頁面後，您會看到：

#### 第一題：基本資訊
```
類別標籤: [基本資訊]

問題: 您好！我是您的專屬客戶經理。首先，請問我該如何稱呼您呢？

💬 很高興認識您！讓我們一起為您的家打造理想的樣貌。

ℹ️ 目的: 建立個人化服務體驗

[文字輸入框]

[下一步 →]
```

**測試要點**：
1. 輸入您的名字（例如：「王先生」）
2. 點擊「下一步」
3. 確認進度條有前進

#### 第二題：空間使用情況
```
類別標籤: [空間現況與使用目的]

問題: 請問這個空間目前的使用情況是什麼？

[選項按鈕]
自住  出租  短租  家人使用  其他

其他說明或補充...
[文字輸入框]

[下一步 →]
```

**測試要點**：
1. 點擊一個選項（例如：「自住」）
2. 選項會變成綠色背景
3. 可以在下方文字框補充說明
4. 點擊「下一步」

#### 第三題：房屋狀況（含同理心訊息和跳過選項）
```
類別標籤: [空間現況與使用目的]

問題: 原先的裝潢做了多久？空間目前有沒有漏水、壁癌、或結構裂縫等問題？

💬 了解房屋狀況能幫我們更準確地評估預算，也能避免施工時才發現問題。

ℹ️ 目的: 評估是否需額外修繕工程與防水補強費

✨ 如果您不太確定，沒關係！我們的設計師到現場丈量時會仔細檢查，給您專業建議。

[選項按鈕]
全新屋況，無問題  5年內，狀況良好  5-10年，有輕微問題
10年以上，有明顯問題  不確定，需要專業評估

[稍後再決定]  [下一步 →]
```

**測試要點**：
1. 注意三種不同類型的訊息：
   - 💬 同理心訊息（綠色漸層背景）
   - ℹ️ 資訊目的（橘色背景）
   - ✨ 跳過建議（紫色背景）
2. 測試「稍後再決定」按鈕
   - 點擊後會自動填入「稍後由設計師現場確認」並提交
3. 或選擇一個選項後點「下一步」

#### 預算問題（重要且敏感）
```
類別標籤: [預算與期望]

問題: 關於預算，我完全理解這是很實際的考量。您心中的預算區間大約是多少？

💬 預算規劃很重要，我會根據您的預算提供最合適的方案。如果預算有彈性，
    我也會提供不同等級的選擇讓您參考。

ℹ️ 目的: 決定報價深度與材質等級

[選項按鈕]
50萬以內  50-100萬  100-200萬  200萬以上  希望先了解行情再決定

[下一步 →]
```

**測試要點**：
1. 注意同理心訊息的語氣（理解、不施壓）
2. 選擇一個預算範圍
3. 觀察後續問題是否有針對性

#### 拆除清運費用（新增問題）
```
類別標籤: [拆除與保護工程]

問題: 關於拆除產生的廢棄物清運費用，您目前的報價單有包含嗎？或是您希望如何處理？

💬 清運費常常是容易被忽略的項目，確認清楚可以避免日後糾紛。

ℹ️ 目的: 確認清運費用歸屬，避免後續爭議

[選項按鈕]
報價已包含清運費  清運費另計  希望包含在總價內  還不確定，需要建議

[下一步 →]
```

**測試要點**：
1. 這是根據您的需求新增的問題
2. 確認選項涵蓋了各種情況
3. 同理心訊息強調避免糾紛

---

### 測試 4: 進度追蹤

在整個訪談過程中：

1. **進度條應該持續更新**
   - 初始：0%
   - 每回答一題，進度增加約 3-4%
   - 最後一題：100%

2. **分類標籤會改變**
   - 基本資訊 → 空間現況 → 預算期望 → 設計風格 → 各項工程 → 施工條件 → 驗收保固

3. **總共 28-29 題**
   - 可以隨時觀察右上角進度百分比
   - Console 中可以看到當前問題編號

---

### 測試 5: 訪談完成

回答所有問題後：

1. **完成畫面**：
   ```
   ✓ 需求訪談完成！

   王先生，感謝您提供這麼詳細的資訊！

   根據您的需求，我已經為您整理出完整的專案簡報：
   • 裝修風格：北歐風（簡約、明亮、木質感）
   • 預算範圍：100-200萬
   • 工程範圍：全室裝修（包含水電、衛浴）

   現在我會將這份資料交給我們的專業統包商和設計師團隊...

   進度: ████████████████████ 100% 完成
   ```

2. **自動跳轉**
   - 2秒後自動進入「步驟 3/3: 專業分析結果」頁面

3. **開發者工具檢查**：
   - 在 Console 查看完整的 `project_brief` 物件
   - 應該包含所有分類的答案

---

### 測試 6: 結果展示頁面

目前會顯示：
- FinalResult 組件（已存在）
- 專案簡報資料
- 「預約免費丈量」按鈕

---

## 🔍 API 端點測試

### 使用瀏覽器測試

1. **檢查 API 狀態**
   ```
   http://localhost:8000/
   ```
   應回傳：`{"message": "Analysis Service is running!"}`

2. **查看 API 文件**
   ```
   http://localhost:8000/docs
   ```
   可以看到 Swagger UI，列出所有 API 端點

### 使用 curl 測試

```bash
# 1. 建立新專案
curl -X POST http://localhost:8000/api/projects

# 預期回應（記下 project_id）：
# {
#   "project_id": "xxx-xxx-xxx",
#   "user_id": "anonymous",
#   "status": "created",
#   "created_at": "2024-11-16T...",
#   "welcome_message": "歡迎來到 HouseIQ..."
# }

# 2. 開始訪談（替換 {project_id}）
curl -X POST http://localhost:8000/api/projects/{project_id}/conversation/start

# 預期回應：第一個問題的 JSON

# 3. 提交答案
curl -X POST http://localhost:8000/api/projects/{project_id}/conversation/answer \
  -H "Content-Type: application/json" \
  -d '{"question_id": "basic_001", "answer": "王先生"}'

# 預期回應：下一個問題的 JSON

# 4. 查詢訪談狀態
curl http://localhost:8000/api/projects/{project_id}/conversation/status

# 預期回應：
# {
#   "project_id": "xxx",
#   "conversation_started": true,
#   "progress": 10,
#   "total_questions": 28,
#   "answered_questions": 2
# }
```

---

## 🐛 常見問題排除

### 問題 1: 後端啟動失敗

**錯誤訊息**：`ModuleNotFoundError: No module named 'xxx'`

**解決方式**：
```bash
cd analysis-service
pip3 install -r requirements.txt --upgrade
```

---

### 問題 2: 前端無法連接後端

**錯誤訊息**：`Failed to fetch` 或 `Network Error`

**檢查清單**：
1. 確認後端是否在運行：
   ```bash
   curl http://localhost:8000
   ```
2. 確認端口 8000 沒被占用：
   ```bash
   lsof -i :8000
   ```
3. 檢查瀏覽器 Console 的錯誤訊息

---

### 問題 3: 前端依賴安裝失敗

**錯誤訊息**：`npm ERR!`

**解決方式**：
```bash
cd web-service
rm -rf node_modules package-lock.json
npm install
```

---

### 問題 4: CORS 錯誤

**錯誤訊息**：`Access to fetch at ... has been blocked by CORS policy`

**解決方式**：
後端已經配置 CORS，但如果還是有問題：
1. 確認後端的 `main.py` 包含 CORS 中間件
2. 重啟後端服務

---

### 問題 5: 訪談無法進行

**症狀**：點擊「下一步」沒反應

**檢查步驟**：
1. 打開瀏覽器開發者工具（F12）
2. 查看 Console 分頁的錯誤訊息
3. 查看 Network 分頁，確認 API 請求狀態
4. 確認是否有填入答案（文字框不能為空）

---

## 📊 測試檢查清單

完整測試後，確認以下功能：

- [ ] 後端服務成功啟動
- [ ] 前端服務成功啟動
- [ ] 歡迎頁面正常顯示
- [ ] 專案 ID 自動生成
- [ ] 報價單可以上傳
- [ ] 或可以跳過上傳
- [ ] 訪談流程開始
- [ ] 第一題顯示正確
- [ ] 可以選擇選項
- [ ] 可以輸入文字
- [ ] 同理心訊息顯示（💬）
- [ ] 資訊目的顯示（ℹ️）
- [ ] 跳過建議顯示（✨，僅特定問題）
- [ ] 「稍後再決定」按鈕可用
- [ ] 進度條正常更新
- [ ] 分類標籤正常切換
- [ ] 可以完成所有問題
- [ ] 完成畫面正確顯示
- [ ] 專案簡報正確生成
- [ ] 自動跳轉到結果頁

---

## 🎯 新功能測試重點

### 同理心設計

在訪談過程中，特別注意以下問題有同理心訊息：

1. **基本資訊（basic_001）**
   - 同理心訊息：「很高興認識您！讓我們一起為您的家打造理想的樣貌。」

2. **房屋狀況（space_002）**
   - 同理心訊息：「了解房屋狀況能幫我們更準確地評估預算...」
   - 跳過建議：「如果您不太確定，沒關係！我們的設計師...」

3. **預算問題（budget_001）**
   - 同理心訊息：「預算規劃很重要，我會根據您的預算提供最合適的方案...」

4. **拆除工程（demolition_001, demolition_002）**
   - 同理心訊息：「拆除工程是裝修的第一步，做好規劃很重要。」
   - 同理心訊息：「清運費常常是容易被忽略的項目，確認清楚可以避免日後糾紛。」

### 靈活跳過機制

測試可以跳過的問題：
- `space_002` - 房屋狀況（如果不確定）

點擊「稍後再決定」後：
1. 自動填入「稍後由設計師現場確認」
2. 自動提交並跳到下一題
3. 此答案會記錄在專案簡報中

---

## 📝 測試記錄範例

建議在測試時記錄：

```
測試日期：2024-11-16
測試人員：[您的名字]

【後端測試】
✅ 後端啟動成功
✅ API 文件可訪問 (http://localhost:8000/docs)
✅ 建立專案端點正常
✅ 訪談流程端點正常

【前端測試】
✅ 前端啟動成功
✅ 歡迎頁面顯示正常
✅ 上傳功能正常
✅ 訪談流程完整

【使用者體驗】
✅ 進度條清晰
✅ 同理心訊息友善
✅ 跳過選項實用
✅ 完成流程順暢

【發現問題】
- [記錄任何問題]

【改進建議】
- [記錄改進想法]
```

---

## 🎨 視覺檢查

確認以下視覺元素：

1. **配色**
   - 主色：紫色漸層 (#667eea → #764ba2)
   - 成功色：綠色 (#4CAF50)
   - 警告色：橘色 (#FF9800)
   - 提示色：紫色 (#9C27B0)

2. **訊息框樣式**
   - 同理心訊息：綠色漸層背景，左側綠色邊框
   - 資訊目的：橘色背景，左側橘色邊框
   - 跳過建議：紫色背景，左側紫色邊框

3. **按鈕樣式**
   - 主按鈕：綠色，hover 有上浮效果
   - 跳過按鈕：紫色邊框，hover 淺紫色背景

4. **響應式設計**
   - 在手機寬度測試（Chrome DevTools → Toggle device toolbar）
   - 確認在小螢幕上仍可正常使用

---

## 🚦 下一步

測試完成後，您可以：

1. **優化問題內容**
   - 修改 `analysis-service/src/agents/client_manager.py`
   - 調整問題文字、選項、同理心訊息

2. **調整視覺設計**
   - 修改 `web-service/src/components/InteractiveQuestionnaire.css`
   - 修改 `web-service/src/App.css`

3. **整合真實服務**
   - 連接 Vertex AI for LLM
   - 連接 Imagen for 圖片生成
   - 連接 Firestore for 資料持久化

4. **部署到 Cloud Run**
   - 使用 `cloudbuild.yaml` 自動部署
   - 參考 `docs/deployment.md`

---

**祝測試順利！如有任何問題，請檢查上方的「常見問題排除」章節。**
